# 要件定義書

## 概要

この機能は、AWS CloudOps試験問題を生成するための最小限のバックエンドツールを作成します。このツールは、AWS Document MCPサーバーとStrands Agentsを使用して正確性を確保しながら、一度に10問の問題を生成します。既存のWebアプリケーションに影響を与えないスタンドアロンユーティリティとして設計され、実行に失敗した場合は再実行できるシンプルなエラー回復アプローチを採用しています。

## 要件

### 要件1

**ユーザーストーリー:** AWS CloudOps試験アプリを保守する開発者として、一度に10問の問題を生成するシンプルなコマンドラインツールが欲しい。そうすることで、複雑なバッチ管理なしに問題データベースを段階的に構築できる。

#### 受入基準

1. ツールが実行された時、システムは1回の実行で正確に10問の問題を生成するものとする
2. ツールが正常に完了した時、システムは既存のquestions.jsonと同じJSON形式で問題を出力するものとする
3. ツールが実行された時、システムは新しいファイルを作成して10問の問題を保存するものとする
4. ツールが問題を生成した時、システムはタイムスタンプベースの一意のIDを各問題に割り当てるものとする

### 要件2

**ユーザーストーリー:** 開発者として、技術的正確性を確保するためにAWS Document MCPサーバーを使用するツールが欲しい。そうすることで、生成された問題が現在のAWSドキュメントとベストプラクティスを反映する。

#### 受入基準

1. 問題コンテンツを生成する時、システムはAWS Document MCPサーバーを使用して現在のAWSドキュメントを取得するものとする
2. 解説を作成する時、システムはMCPサーバーを通じて公式AWSドキュメントを参照するものとする
3. 学習リソースを生成する時、システムは公式AWSドキュメントからのURLを含むものとする
4. 技術的詳細を検証する時、システムはMCP経由でAWSドキュメントと情報を照合するものとする

### 要件3

**ユーザーストーリー:** 開発者として、インテリジェントな問題生成のためにStrands Agentsを使用するツールが欲しい。そうすることで、問題が適切に構造化され、文脈に適したものになる。

#### 受入基準

1. ツールが開始された時、システムは適切なモデル設定でStrands Agentsを初期化するものとする
2. 問題を生成する時、システムはStrands Agentsを使用して一貫性のある問題文、選択肢、解説を作成するものとする
3. AWSドキュメントを処理する時、システムはStrands Agentsを使用して問題作成に関連する情報を抽出するものとする
4. 問題の解説を作成する時、システムはStrands Agentsを使用して明確で教育的なコンテンツを生成するものとする

### 要件4

**ユーザーストーリー:** 開発者として、既存の問題構造とドメインに従うツールが欲しい。そうすることで、生成された問題が現在のアプリケーションとシームレスに統合される。

#### 受入基準

1. 問題を生成する時、システムは5つのAWS CloudOpsドメイン（監視、信頼性、デプロイメント、セキュリティ、ネットワーキング）に問題を配分するものとする
2. 問題を作成する時、システムは単一選択と複数選択の両方の問題タイプを含むものとする
3. 難易度を設定する時、システムは適切な難易度レベル（easy、medium、hard）を割り当てるものとする
4. コンテンツを生成する時、システムは既存のアプリケーションに合わせて日本語で問題を作成するものとする

### 要件5

**ユーザーストーリー:** 開発者として、シンプルなエラー回復メカニズムが欲しい。そうすることで、ツールが問題に遭遇した時に進捗を失うことなく簡単に再試行できる。

#### 受入基準

1. 実行中にエラーが発生した時、システムは詳細なエラー情報をログに記録するものとする
2. ツールが失敗した時、システムは既存のquestions.jsonファイルを破損させないものとする
3. エラー後に再実行する時、システムは手動クリーンアップなしに新たに開始できるものとする
4. API制限やタイムアウトに遭遇した時、システムは手動再試行のための明確なエラーメッセージを提供するものとする

### 要件6

**ユーザーストーリー:** 開発者として、Webアプリケーションから完全に分離されたツールが欲しい。そうすることで、問題生成がユーザー向け機能に干渉しない。

#### 受入基準

1. ツールが実行される時、システムはWebアプリケーションコードから独立して動作するものとする
2. 問題を生成する時、システムはWebアプリケーションが実行されている必要がないものとする
3. ツールがインストールされた時、システムは既存のWebアプリケーションファイルを変更しないものとする
4. 問題が生成された時、システムは独立したファイルとして出力し、既存ファイルを変更しないものとする

### 要件7

**ユーザーストーリー:** 開発者として、コンテキストのために試験ガイドを使用するツールが欲しい。そうすることで、生成された問題が公式のAWS CloudOps認定要件と整合する。

#### 受入基準

1. 問題を生成する時、システムはドメインカバレッジのためにAWS CloudOps試験ガイドを参照するものとする
2. 問題コンテンツを作成する時、システムは試験目標との整合性を確保するものとする
3. 問題の難易度を設定する時、システムは試験ガイドのスキル要件を考慮するものとする
4. 解説を生成する時、システムは試験に関連するAWSサービスと概念を参照するものとする

### 要件8

**ユーザーストーリー:** 開発者として、uvを使用してPythonツールを実行したい。そうすることで、既存のプロジェクト環境と一貫性を保てる。

#### 受入基準

1. ツールが実行される時、システムはuvを使用してPython環境を管理するものとする
2. 依存関係をインストールする時、システムはuvのパッケージ管理機能を使用するものとする
3. ツールが起動される時、システムは既存のuvプロジェクト設定と互換性を保つものとする
4. Python実行環境が必要な時、システムはuvの仮想環境機能を活用するものとする

### 要件9

**ユーザーストーリー:** 開発者として、構造化出力機能を使用して一貫性のある問題を生成したい。そうすることで、生成される問題の品質と形式が保証される。

#### 受入基準

1. 問題を生成する時、システムはStrands AgentsのPydanticベースの構造化出力機能を使用するものとする
2. 問題データが作成される時、システムは型安全性を保証するものとする
3. 生成された問題が検証される時、システムは自動的にスキーマ検証を実行するものとする
4. 問題形式にエラーがある時、システムは明確なバリデーションエラーメッセージを提供するものとする

### 要件10

**ユーザーストーリー:** 開発者として、AWS Document MCPサーバーの複数の検索機能を活用したい。そうすることで、より正確で包括的な問題コンテンツを生成できる。

#### 受入基準

1. AWSサービス情報を検索する時、システムはsearch_documentation機能を使用するものとする
2. 詳細なドキュメントが必要な時、システムはread_documentation機能を使用するものとする
3. 関連コンテンツを発見する時、システムはrecommend機能を使用するものとする
4. 学習リソースを検証する時、システムは取得したAWSドキュメントのURLを使用するものとする

### 要件11

**ユーザーストーリー:** 開発者として、指定されたMCP設定を使用してAWS Document MCPサーバーに接続したい。そうすることで、既存の設定と一貫性を保ちながらAWSドキュメントにアクセスできる。

#### 受入基準

1. MCPサーバーに接続する時、システムは"awslabs.aws-documentation-mcp-server"サーバー名を使用するものとする
2. MCPサーバーを起動する時、システムは"uvx"コマンドと"awslabs.aws-documentation-mcp-server@latest"引数を使用するものとする
3. 環境変数を設定する時、システムはFASTMCP_LOG_LEVEL="ERROR"とAWS_DOCUMENTATION_PARTITION="aws"を使用するものとする
4. MCPサーバーが利用できない時、システムは適切なエラーメッセージを表示して処理を停止するものとする

### 要件12

**ユーザーストーリー:** 開発者として、試験ガイドの5つのコンテンツドメインに基づいて問題を生成したい。そうすることで、実際の試験構造に合致した問題配分を実現できる。

#### 受入基準

1. 問題を生成する時、システムはContent Domain 1（Monitoring, Logging, Analysis, Remediation, and Performance Optimization - 22%）を考慮するものとする
2. 問題を生成する時、システムはContent Domain 2（Reliability and Business Continuity - 22%）を考慮するものとする
3. 問題を生成する時、システムはContent Domain 3（Deployment, Provisioning, and Automation - 22%）を考慮するものとする
4. 問題を生成する時、システムはContent Domain 4（Security and Compliance - 16%）を考慮するものとする
5. 問題を生成する時、システムはContent Domain 5（Networking and Content Delivery - 18%）を考慮するものとする
6. ドメイン配分を決定する時、システムは10問中の適切な配分を自動計算するものとする

### 要件13

**ユーザーストーリー:** 開発者として、試験の対象候補者の経験レベルに適した問題を生成したい。そうすることで、実際の試験レベルに合致した適切な難易度の問題を作成できる。

#### 受入基準

1. 問題を作成する時、システムは1年のAWS運用経験レベルを想定するものとする
2. 技術内容を生成する時、システムはシステム管理者レベルの知識を前提とするものとする
3. 問題の複雑さを設定する時、システムは監視、ログ記録、トラブルシューティング技術を含むものとする
4. AWSサービスを選択する時、システムは試験ガイドの推奨AWS知識範囲内のサービスを使用するものとする

### 要件14

**ユーザーストーリー:** 開発者として、試験ガイドで明確に範囲外とされた内容を避けたい。そうすることで、試験に関連しない問題の生成を防げる。

#### 受入基準

1. 問題を生成する時、システムは分散アーキテクチャの設計に関する問題を作成しないものとする
2. 問題を生成する時、システムはCI/CDパイプラインの設計に関する問題を作成しないものとする
3. 問題を生成する時、システムはソフトウェア開発に関する問題を作成しないものとする
4. 問題を生成する時、システムはコスト分析や請求管理に関する問題を作成しないものとする
5. 問題内容を検証する時、システムは試験ガイドの範囲外タスクリストと照合するものとする

### 要件15

**ユーザーストーリー:** 開発者として、複数回の実行でもID重複を防ぎたい。そうすることで、異なるタイミングでツールを実行してもデータの整合性が保たれる。

#### 受入基準

1. 問題IDを生成する時、システムは実行時のタイムスタンプを基にした一意のIDを作成するものとする
2. IDの形式は"q{YYYYMMDD}_{HHMMSS}_{001-010}"パターンに従うものとする（例：q20250115_143022_001）
3. 同一実行内の10問は連続番号（001-010）を使用するものとする
4. ID生成処理でエラーが発生した時、システムはUUIDベースの代替ID生成方法を使用するものとする

### 要件16

**ユーザーストーリー:** 開発者として、生成された問題ファイルを適切に管理したい。そうすることで、複数回の実行結果を整理して後で統合できる。

#### 受入基準

1. ファイルを出力する時、システムは"questions_{YYYYMMDD}_{HHMMSS}.json"の命名規則を使用するものとする
2. ファイルを保存する時、システムは指定された出力ディレクトリに保存するものとする
3. 出力ディレクトリが指定されない時、システムは現在のディレクトリに保存するものとする
4. ファイル名が重複する時、システムは末尾に連番を追加して重複を回避するものとする

### 要件17

**ユーザーストーリー:** 開発者として、生成されたファイルのメタデータを管理したい。そうすることで、各ファイルの生成条件と内容を把握できる。

#### 受入基準

1. ファイルを生成する時、システムは生成日時、ドメイン配分、難易度配分をメタデータに記録するものとする
2. メタデータを作成する時、システムは使用したAWS Document MCPサーバーのバージョン情報を含むものとする
3. メタデータを作成する時、システムは生成に使用したStrands Agentsの設定情報を含むものとする
4. ファイルを出力する時、システムはtotalQuestionsを10に設定し、domainsオブジェクトに実際の配分を記録するものとする

### 要件18

**ユーザーストーリー:** 開発者として、実行時の詳細なログ出力を取得したい。そうすることで、問題が発生した際のデバッグと改善が容易になる。

#### 受入基準

1. ツールが実行される時、システムは各ステップの進捗状況をログ出力するものとする
2. エラーが発生した時、システムは詳細なスタックトレースと原因情報をログに記録するものとする
3. AWS Document MCPとの通信時、システムは要求と応答の概要をログに記録するものとする
4. 問題生成が完了した時、システムは生成された問題数と品質メトリクス、出力ファイル名をログに出力するものとする